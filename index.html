<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <title>HSRastit 2025 - Tilastopalvelu</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: row;
      gap: 2rem;
    }
    main {
      flex: 3;
      min-width: 0;
    }
    aside {
      flex: 1;
      background: #eef4fa;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    h1 {
      color: #2a4d69;
    }
    h2 {
      margin-top: 2rem;
      color: #1e3c72;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 2rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 4px 6px;
      text-align: center;
    }
    th.name, td.name {
      text-align: left;
    }
    .footer {
      margin-top: 2rem;
      font-size: 0.85rem;
    }
    .footer a {
      color: #2a4d69;
      text-decoration: none;
    }
    .footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <main>
    <h1>HSRastit 2025 - Pistekooste</h1>
    <p>HSRastit 2025 -tapahtumien pistetilanne. Pistejako: 25, 22, 21, 18, 17, 15, 13, 11, 9, 7, 5, 3, muut 1 piste, hylätty 0 pistettä.</p>
    <div id="taulukot"></div>
  </main>

  <aside>
    <h2>Menneet tapahtumat</h2>
    <ul>
      <li>Urheilupuisto-Keskusta, RiSu, 23.3.</li>
      <li>Ahvenisto 2023, 16.4.</li>
    </ul>
    <h2>Tulevat tapahtumat</h2>
    <ul>
      <li>Monikkala/2024, 24.4.</li>
      <li>Vipukorpi 2024, 1.5.</li>
      <li>Moreeni / 2023, 8.5.</li>
      <li>Konttila 2024, 15.5.</li>
      <li>Evo, 22.5.</li>
      <li>Aulanko, ulkoilumaja / 2024, 29.5.</li>
      <li>Hiidenkorpi / 2023, 5.6.</li>
      <li>Evo, 12.6.</li>
      <li>Pyyttämö 2023, 24.6.</li>
      <li>Poutunkangas, 26.6.</li>
      <!-- jatkuu... -->
    </ul>
    <div class="footer">
      <p>Sivustoa ylläpitää<br>
      <strong>Lassi Heiskanen</strong><br>
      <a href="mailto:heiskanen.lassi@gmail.com">heiskanen.lassi@gmail.com</a></p>
    </div>
  </aside>

  <script>
    const tapahtumat = ['23032025.json', '16042025.json'];
    const pisteet = [25, 22, 21, 18, 17, 15, 13, 11, 9, 7, 5, 3];
    const tulokset = {};
    const paivat = [];

    async function haeTulokset() {
      for (const tiedosto of tapahtumat) {
        const pvm = tiedosto.substring(0, 2) + '.' + tiedosto.substring(2, 4) + '.';
        paivat.push(pvm);
        const res = await fetch(tiedosto);
        const data = await res.json();

        for (const rata in data) {
          if (!tulokset[rata]) tulokset[rata] = {};
          data[rata].forEach((nimi, i) => {
            const cleanName = nimi.replace(/\s+\d.*$/, '');
            if (!tulokset[rata][cleanName]) {
              tulokset[rata][cleanName] = { nimi: cleanName, osallistumisia: 0, pisteet: 0, sijoitukset: {} };
            }
            const os = tulokset[rata][cleanName];
            os.osallistumisia++;
            os.pisteet += pisteet[i] || 1;
            os.sijoitukset[pvm] = (i + 1) + '.';
          });
        }
      }

      const container = document.getElementById('taulukot');
      for (const rata in tulokset) {
        const taulukko = document.createElement('table');
        const thead = document.createElement('thead');
        const header = document.createElement('tr');
        ['Kokonaissijoitus', 'Nimi', 'Osallistumisia', 'Pisteet', ...paivat].forEach(ots => {
          const th = document.createElement('th');
          th.textContent = ots;
          header.appendChild(th);
        });
        thead.appendChild(header);
        taulukko.appendChild(thead);

        const tbody = document.createElement('tbody');
        const osallistujat = Object.values(tulokset[rata])
          .sort((a, b) => b.pisteet - a.pisteet);

        osallistujat.forEach((os, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${idx + 1}.</td>
            <td class="name">${os.nimi}</td>
            <td>${os.osallistumisia}</td>
            <td>${os.pisteet}</td>
            ${paivat.map(p => `<td>${os.sijoitukset[p] || 'x'}</td>`).join('')}
          `;
          tbody.appendChild(tr);
        });

        taulukko.appendChild(tbody);
        const otsikko = document.createElement('h2');
        otsikko.textContent = rata;
        container.appendChild(otsikko);
        container.appendChild(taulukko);
      }
    }

    haeTulokset();
  </script>
</body>
</html>
